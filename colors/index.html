<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Color Designer</title>
  <style>
  body {
    margin: 0;
    padding: 0;
    font-family: Consolas, monospace;
    font-size: 12pt;
  }

  /* base ANSI color names and "standard" values */
  .ansi .black     { color: rgb(   0,   0,   0 ); }
  .ansi .red       { color: rgb( 191,   0,   0 ); }
  .ansi .green     { color: rgb(   0, 191,   0 ); }
  .ansi .yellow    { color: rgb( 191, 191,   0 ); }
  .ansi .blue      { color: rgb(   0,   0, 191 ); }
  .ansi .magenta   { color: rgb( 191,   0, 191 ); }
  .ansi .cyan      { color: rgb(   0, 191, 191 ); }
  .ansi .white     { color: rgb( 191, 191, 191 ); }
  .ansi .brblack   { color: rgb(  64,  64,  64 ); }
  .ansi .brred     { color: rgb( 255,  64,  64 ); }
  .ansi .brgreen   { color: rgb(  64, 255,  64 ); }
  .ansi .bryellow  { color: rgb( 255, 255,  64 ); }
  .ansi .brblue    { color: rgb(  64,  64, 255 ); }
  .ansi .brmagenta { color: rgb( 255,  64, 255 ); }
  .ansi .brcyan    { color: rgb(  64, 255, 255 ); }
  .ansi .brwhite   { color: rgb( 255, 255, 255 ); }

  /* ANSI colors that work on light/white backgrounds */
  .inverted .black     { color: rgb( 255, 255, 255 ); }
  .inverted .red       { color: rgb( 191,   0,   0 ); }
  .inverted .green     { color: rgb(   0, 128,   0 ); }
  .inverted .yellow    { color: rgb( 255, 128,   0 ); }
  .inverted .blue      { color: rgb(   0,   0, 191 ); }
  .inverted .magenta   { color: rgb( 191,   0, 191 ); }
  .inverted .cyan      { color: rgb(   0, 128, 128 ); }
  .inverted .white     { color: rgb(  64,  64,  64 ); }
  .inverted .brblack   { color: rgb( 128, 128, 128 ); }
  .inverted .brred     { color: rgb( 255,  64,  64 ); }
  .inverted .brgreen   { color: rgb(  32, 191,  32 ); }
  .inverted .bryellow  { color: rgb( 128,  64,   0 ); }
  .inverted .brblue    { color: rgb(  64,  64, 255 ); }
  .inverted .brmagenta { color: rgb( 255,  64, 255 ); }
  .inverted .brcyan    { color: rgb(   0, 191, 191 ); }
  .inverted .brwhite   { color: rgb(   0,   0,   0 ); }

  /* xterm ANSI color mapping */
  .xterm .black     { color: rgb(   0,   0,   0 ); }
  .xterm .red       { color: rgb( 205,   0,   0 ); }
  .xterm .green     { color: rgb(   0, 205,   0 ); }
  .xterm .yellow    { color: rgb( 205, 205,   0 ); }
  .xterm .blue      { color: rgb(   0,   0, 238 ); }
  .xterm .magenta   { color: rgb( 205,   0, 205 ); }
  .xterm .cyan      { color: rgb(   0, 205, 205 ); }
  .xterm .white     { color: rgb( 229, 229, 229 ); }
  .xterm .brblack   { color: rgb( 127, 127, 127 ); }
  .xterm .brred     { color: rgb( 255,   0,   0 ); }
  .xterm .brgreen   { color: rgb(   0, 255,   0 ); }
  .xterm .bryellow  { color: rgb( 255, 255,   0 ); }
  .xterm .brblue    { color: rgb(  92,  92, 255 ); }
  .xterm .brmagenta { color: rgb( 255,   0, 255 ); }
  .xterm .brcyan    { color: rgb(   0, 255, 255 ); }
  .xterm .brwhite   { color: rgb( 255, 255, 255 ); }

  /* Windows terminal ANSI color mapping */
  .windows .black     { color: rgb(   0,   0,   0 ); }
  .windows .red       { color: rgb( 128,   0,   0 ); }
  .windows .green     { color: rgb(   0, 128,   0 ); }
  .windows .yellow    { color: rgb( 128, 128,   0 ); }
  .windows .blue      { color: rgb(   0,   0, 128 ); }
  .windows .magenta   { color: rgb( 128,   0, 128 ); }
  .windows .cyan      { color: rgb(   0, 128, 128 ); }
  .windows .white     { color: rgb( 192, 192, 192 ); }
  .windows .brblack   { color: rgb( 128, 128, 128 ); }
  .windows .brred     { color: rgb( 255,   0,   0 ); }
  .windows .brgreen   { color: rgb(   0, 255,   0 ); }
  .windows .bryellow  { color: rgb( 255, 255,   0 ); }
  .windows .brblue    { color: rgb(   0,   0, 255 ); }
  .windows .brmagenta { color: rgb( 255,   0, 255 ); }
  .windows .brcyan    { color: rgb(   0, 255, 255 ); }
  .windows .brwhite   { color: rgb( 255, 255, 255 ); }

  /* solarized suggested ANSI mapping */
  .solarized .black     { color: rgb(   7,  54,  66 ); }
  .solarized .red       { color: rgb( 220,  50,   1 ); }
  .solarized .green     { color: rgb( 133, 153,   0 ); }
  .solarized .yellow    { color: rgb( 181, 137,   0 ); }
  .solarized .blue      { color: rgb(  38, 139, 210 ); }
  .solarized .magenta   { color: rgb( 211,  54, 130 ); }
  .solarized .cyan      { color: rgb(  42, 161, 152 ); }
  .solarized .white     { color: rgb( 238, 232, 213 ); }
  .solarized .brblack   { color: rgb(   0,  43,  54 ); }
  .solarized .brred     { color: rgb( 203,  75,  22 ); }
  .solarized .brgreen   { color: rgb(  88, 110, 117 ); }
  .solarized .bryellow  { color: rgb( 101, 123, 131 ); }
  .solarized .brblue    { color: rgb( 131, 148, 150 ); }
  .solarized .brmagenta { color: rgb( 108, 113, 196 ); }
  .solarized .brcyan    { color: rgb( 147, 161, 161 ); }
  .solarized .brwhite   { color: rgb( 253, 246, 227 ); }
  /* AKA: base02, red, green, yellow, blue, magenta, cyan, base2,
     base03, orange, base01, base00, base0, violet, base1, base3 */

  </style>
<script>
function select_text( element ) {
  var range, selection;
  selection = window.getSelection();
  range = document.createRange();
  range.selectNodeContents( element );
  selection.removeAllRanges();
  selection.addRange( range );
}


function Color( r, g, b ) {
  this._r = r;
  this._g = g;
  this._b = b;
  this._h = 0.0;
  this._s = 0.0;
  this._l = 0.0;
  this._update_hsl();
}
Color.prototype.getHex = function() {
  var r = Math.floor( this._r * 255.0 ).toString( 16 ).toUpperCase();
  var g = Math.floor( this._g * 255.0 ).toString( 16 ).toUpperCase();
  var b = Math.floor( this._b * 255.0 ).toString( 16 ).toUpperCase();
  r = ( '00' + r ).slice( -2 );
  g = ( '00' + g ).slice( -2 );
  b = ( '00' + b ).slice( -2 );
  return '#' + r + g + b;
};
Color.prototype.getHSL = function() {
  var chroma, l, h, h_prime, max, min, s;
  max = Math.max( this._r, this._g, this._b );
  min = Math.min( this._r, this._g, this._b );
  chroma = max - min;
  l = ( max + min ) / 2.0;
  if( chroma == 0.0 ) {
    h_prime = 0.0;
    s = 0.0;
  }
  else {
    switch( max ) {
      case this._r:
        h_prime = ( this._g - this._b ) / chroma;
        if( this._g < this._b ) { h_prime += 6.0; }
        break;
      case this._g:
        h_prime = ( ( this._b - this._r ) / chroma ) + 2.0;
        break;
      case this._b:
        h_prime = ( ( this._r - this._g ) / chroma ) + 4.0;
        break;
      default:
        h_prime = 0.0;
        break;
    }
    s = chroma / ( 1 - Math.abs( ( 2 * l ) - 1 ) );
  }
  h = h_prime * 60.0;
  return [ ( h / 360.0 ), s, l ];
};
Color.prototype.getHSL2 = function() {
  var alpha, beta, chroma, l, max, min, h, s;
  alpha = ( ( 2 * this._r ) - this._g - this._b ) / 2.0;
  beta  = Math.pow( ( this._g - this._b ), ( 1.0 / 3.0 ) ) / 2.0;
  h = Math.atan2( beta, alpha );
  chroma = Math.sqrt( ( alpha * alpha ) + ( beta * beta ) );
  max = Math.max( this._r, this._g, this._b );
  min = Math.min( this._r, this._g, this._b );
  l = ( max + min ) / 2.0;
  s = chroma / ( 1 - Math.abs( ( 2 * l ) - 1 ) );
  return [ ( h / 360.0 ), s, l ];
};
Color.prototype.getRGB = function() {
  var b, chroma, g, h_prime, m, r, x;
  chroma = ( 1 - Math.abs( ( 2 * this._l ) - 1 ) ) * this._s;
  h_prime = this._h * 360.0 / 60.0;
  x = chroma * ( 1 - Math.abs( ( h_prime % 2 ) - 1 ) );
  m = this._l - ( chroma / 2.0 );
  if( m < 0.0 ) { m = 0.0; }
  if( ( h_prime < 0.0 ) || ( h_prime >= 6.0 ) ) {
    r = 0.0; g = 0.0; b = 0.0;
  }
  else if( h_prime < 1.0 ) {
    r = chroma; g = x; b = 0.0;
  }
  else if( h_prime < 2.0 ) {
    r = x; g = chroma; b = 0.0;
  }
  else if( h_prime < 3.0 ) {
    r = 0.0; g = chroma; b = x;
  }
  else if( h_prime < 4.0 ) {
    r = 0.0; g = x; b = chroma;
  }
  else if( h_prime < 5.0 ) {
    r = x; g = 0.0; b = chroma;
  }
  else if( h_prime < 6.0 ) {
    r = chroma; g = 0.0; b = x;
  }
  return [ ( r + m ), ( g + m ), ( b + m ) ];
};
Color.prototype.setBlue = function( b ) {
  this._b = b;
  this._update_hsl();
};
Color.prototype.setGreen = function( g ) {
  this._g = g;
  this._update_hsl();
};
Color.prototype.setHue = function( h ) {
  this._h = h;
  this._update_rgb();
};
Color.prototype.setHSL = function( h, s, l ) {
  this._h = h;
  this._s = s;
  this._l = l;
  this._update_rgb();
};
Color.prototype.setLightness = function( l ) {
  this._l = l;
  this._update_rgb();
};
Color.prototype.setRed = function( r ) {
  this._r = r;
  this._update_hsl();
};
Color.prototype.setRGB = function( r, g, b ) {
  this._r = r;
  this._g = g;
  this._b = b;
  this._update_hsl();
};
Color.prototype.setSaturation = function( s ) {
  this._s = s;
  this._update_rgb();
};
Color.prototype.toString = function() {
  return this.getHex();
};
Color.prototype._update_hsl = function() {
  [ this._h, this._s, this._l ] = this.getHSL();
};
Color.prototype._update_rgb = function() {
  [ this._r, this._g, this._b ] = this.getRGB();
};

var color = new Color( 0.0, 0.0, 0.0 );

ui = {};
ui.omap = function( target, source ) {
    for( var key in source ) {
        target[ key ] = source[ key ];
    }
};

function RangeWidget( label, value, min, max, step ) {

  this._spec = {
    'type'  : 'range',
    'min'   : min   || 0.0,
    'max'   : max   || 1.0,
    'step'  : step  || 0.01,
    'value' : value || 0.0
  };

  this.oninput = null;

  this.element = document.createElement( 'label' );

  var span    = document.createElement( 'span' );
  this._label = document.createTextNode( label || 'X' );
  span.appendChild( this._label );
  this.element.appendChild( span );

  span = document.createElement( 'span' );
  this._range = document.createElement( 'input' );
  ui.omap( this._range, this._spec );
  this._range.style.width = '256px';
  var context = this;
  this._range.oninput = ( function( event ) {
    context._set_display( event.target.value );
    if( context.oninput != null ) { context.oninput( event ); }
  } );
  span.appendChild( this._range );
  this.element.appendChild( span );

  span       = document.createElement( 'span' );
  var button = document.createElement( 'input' );
  ui.omap( button, { 'type' : 'button', 'value' : '<' } );
  button.onclick = ( function( event ) {
    var v = context.get_value();
    if( v > context._spec.min ) {
      context.set_value( v - context._spec.step );
      if( context.oninput != null ) { context.oninput( event ); }
    }
  } );
  span.appendChild( button );
  button = document.createElement( 'input' );
  ui.omap( button, { 'type' : 'button', 'value' : '>' } );
  button.onclick = ( function( event ) {
    var v = context.get_value();
    if( v < context._spec.max ) {
      context.set_value( v + context._spec.step );
      if( context.oninput != null ) { context.oninput( event ); }
    }
  } );
  span.appendChild( button );
  this.element.appendChild( span );

  span          = document.createElement( 'span' );
  this._display = document.createTextNode( '' );
  this._set_display( value );
  span.appendChild( this._display );
  this.element.appendChild( span );

}
RangeWidget.prototype.get_label = function() {
  return this._label.nodeValue;
};
RangeWidget.prototype.get_value = function() {
  return parseFloat( this._range.value );
};
RangeWidget.prototype.set_label = function( label ) {
  this._label.nodeValue = label;
};
RangeWidget.prototype.set_value = function( value ) {
  this._range.value = value;
  this._set_display( value );
};
RangeWidget.prototype.update = function() {
  this._set_display( this.get_value() );
};
RangeWidget.prototype._set_display = function( value ) {
  this._display.nodeValue = value;
};


function GradientStop( color, position ) {
  this.color    = color    || 'transparent';
  this.position = position || null;
}
GradientStop.prototype.toString = function() {
  if( this.position != null ) {
    return this.color + ' ' + this.position;
  }
  return this.color.toString();
};


function Gradient() {
  this.stops = arguments.length > 0 ? [].slice.call( arguments ) : [];
}
Gradient.prototype.addStop = function( stop ) {
  this.stops.push( stop );
  return this.stops.length - 1;
};
Gradient.prototype.setStop = function( index, stop ) {
  this.stops[ index ] = stop;
};
Gradient.prototype.toString = function() {
  return this.stops.join( ',' );
};


function ColorDimensionWidget( label, value ) {
  RangeWidget.call( this, label, value, 0.0, 1.0, 0.0025 );
  this.gradient = new Gradient();
  this._has_gradient = false;
  var colors = arguments.length > 2 ? [].slice.call( arguments, 2 ) : [];
  for( var i = 0; i < colors.length; ++i ) {
  	this._has_gradient = true;
    this.gradient.addStop( new GradientStop( colors[ i ] ) );
  }
  this._rnode = this._range.parentNode;
  ui.omap( this._rnode.style, {
    'backgroundRepeat'   : 'no-repeat',
    'backgroundPosition' : '15px 0',
    'backgroundSize'     : 'calc( 100% - 30px ) 100%'
  } );
  this._set_display = function( value ) {
    value = Math.round( value * 10000.0 ) / 10000.0;
    this._display.nodeValue = value.toFixed( 4 );
    if( this._has_gradient == true ) {
      this._rnode.style.backgroundImage = 'linear-gradient( to right, '
        + this.gradient + ')';
    }
  };
  this._set_display( value );
}
ColorDimensionWidget.prototype = new RangeWidget;
ColorDimensionWidget.prototype.addGradientStop = function( color ) {
  this._has_gradient = true;
  this.gradient.addStop( new GradientStop( color ) );
};
ColorDimensionWidget.prototype.setGradientStop = function( index, color ) {
  this._has_gradient = true;
  this.gradient.setStop( index, new GradientStop( color ) );
};


function XYZWidget( x, y, z ) {
  x = x || 0.0;
  y = y || 0.0;
  z = z || 0.0;
  this.x = new ColorDimensionWidget( 'X', x );
  this.y = new ColorDimensionWidget( 'Y', y );
  this.z = new ColorDimensionWidget( 'Z', z );
  this.element = document.createElement( 'div' );
  var div = document.createElement( 'div' );
  div.appendChild( this.x.element );
  this.element.appendChild( div );
  div = document.createElement( 'div' );
  div.appendChild( this.y.element );
  this.element.appendChild( div );
  div = document.createElement( 'div' );
  div.appendChild( this.z.element );
  this.element.appendChild( div );
  this.oninput = null;
  var context = this;
  this.x.oninput = function( event ) { context.oninput_x( event ); };
  this.y.oninput = function( event ) { context.oninput_y( event ); };
  this.z.oninput = function( event ) { context.oninput_z( event ); };
}
XYZWidget.prototype.set_values = function( x, y, z ) {
  this.x.set_value( x );
  this.y.set_value( y );
  this.z.set_value( z );
};
XYZWidget.prototype.oninput_x = function( event ) {
  event.range = this.x;
  this.oninput( event );
};
XYZWidget.prototype.oninput_y = function( event ) {
  event.range = this.y;
  this.oninput( event );
};
XYZWidget.prototype.oninput_z = function( event ) {
  event.range = this.z;
  this.oninput( event );
};

function RGBWidget( r, g, b ) {
  XYZWidget.call( this, r, g, b );
  this.x.set_label( 'R' );
  this.y.set_label( 'G' );
  this.z.set_label( 'B' );
  this.c = [
    [ new Color( 0.0, g, b ), new Color( 1.0, g, b ) ],
    [ new Color( r, 0.0, b ), new Color( r, 1.0, b ) ],
    [ new Color( r, g, 0.0 ), new Color( r, g, 1.0 ) ]
  ];
  this.x.addGradientStop( this.c[ 0 ][ 0 ] );
  this.x.addGradientStop( this.c[ 0 ][ 1 ] );
  this.y.addGradientStop( this.c[ 1 ][ 0 ] );
  this.y.addGradientStop( this.c[ 1 ][ 1 ] );
  this.z.addGradientStop( this.c[ 2 ][ 0 ] );
  this.z.addGradientStop( this.c[ 2 ][ 1 ] );
  this.x.update();
  this.y.update();
  this.z.update();
}
RGBWidget.prototype = new XYZWidget;
RGBWidget.prototype.oninput_x = function( event ) {
  var value = this.x.get_value();
  this.c[ 1 ][ 0 ].setRed( value );
  this.c[ 1 ][ 1 ].setRed( value );
  this.c[ 2 ][ 0 ].setRed( value );
  this.c[ 2 ][ 1 ].setRed( value );
  this.y.update();
  this.z.update();
  event.range = this.x;
  this.oninput( event );
};
RGBWidget.prototype.oninput_y = function( event ) {
  var value = this.y.get_value();
  this.c[ 0 ][ 0 ].setGreen( value );
  this.c[ 0 ][ 1 ].setGreen( value );
  this.c[ 2 ][ 0 ].setGreen( value );
  this.c[ 2 ][ 1 ].setGreen( value );
  this.x.update();
  this.z.update();
  event.range = this.y;
  this.oninput( event );
};
RGBWidget.prototype.oninput_z = function( event ) {
  var value = this.z.get_value();
  this.c[ 0 ][ 0 ].setBlue( value );
  this.c[ 0 ][ 1 ].setBlue( value );
  this.c[ 1 ][ 0 ].setBlue( value );
  this.c[ 1 ][ 1 ].setBlue( value );
  this.x.update();
  this.y.update();
  event.range = this.z;
  this.oninput( event );
};


function HSLWidget( h, s, l ) {
  this.element = document.createElement( 'div' );
  this.h = new RangeWidget( 'H', h, 0.0, 0.9975, 0.0025 );
  this.s = new RangeWidget( 'S', s, 0.0, 1.0, 0.0025 );
  this.l = new RangeWidget( 'L', l, 0.0, 1.0, 0.0025 );
  var div = document.createElement( 'div' );
  div.appendChild( this.h.element );
  this.element.appendChild( div );
  div = document.createElement( 'div' );
  div.appendChild( this.s.element );
  this.element.appendChild( div );
  div = document.createElement( 'div' );
  div.appendChild( this.l.element );
  this.element.appendChild( div );
  this.oninput = null;
  var context = this;
  this.h.oninput = ( function( event ) {
    if( context.oninput != null ) {
      context.update(
        context.h.get_value(),
        context.s.get_value(),
        context.l.get_value()
      );
      event.range = context.h;
      context.oninput( event );
    }
  } );
  this.s.oninput = ( function( event ) {
    if( context.oninput != null ) {
      context.update(
        context.h.get_value(),
        context.s.get_value(),
        context.l.get_value()
      );
      event.range = context.s;
      context.oninput( event );
    }
  } );
  this.l.oninput = ( function( event ) {
    if( context.oninput != null ) {
      context.update(
        context.h.get_value(),
        context.s.get_value(),
        context.l.get_value()
      );
      event.range = context.l;
      context.oninput( event );
    }
  } );
  this.update( h, s, l );
}
HSLWidget.prototype.update = function( h, s, l ) {
  this.h.set_value( h );
  this.s.set_value( s );
  this.l.set_value( l );
};

function ColorWidget( r, g, b ) {

  this.color = new Color( r, g, b );

  var hex = this.color.getHex();
  var hsl = this.color.getHSL();

  this.rgb = new RGBWidget( r, g, b );
  this.hsl = new HSLWidget( hsl[ 0 ], hsl[ 1 ], hsl[ 2 ] );

  this.element = document.createElement( 'div' );
  this.display = document.createElement( 'div' );
  this.display.style.minHeight = '1em';
  this.display.style.backgroundColor = hex;
  this.hex = document.createElement( 'div' );
  this.hex.appendChild( document.createTextNode( hex ) );
  this.element.appendChild( this.display );
  this.element.appendChild( this.hex );
  this.element.appendChild( this.rgb.element );
  this.element.appendChild( this.hsl.element );

  var context = this;
  this.rgb.oninput = ( function( event ) {
    var range_label = event.range.get_label();
    switch( range_label ) {
      case 'R':
        context.color.setRed( event.range.get_value() );
        break;
      case 'G':
        context.color.setGreen( event.range.get_value() );
        break;
      case 'B':
        context.color.setBlue( event.range.get_value() );
        break;
    }
    var hex = context.color.getHex();
    var hsl = context.color.getHSL();
    context.display.style.backgroundColor = hex;
    context.hex.firstChild.nodeValue = hex;
    context.hsl.update( hsl[ 0 ], hsl[ 1 ], hsl[ 2 ] );
  } );
  this.hsl.oninput = ( function( event ) {
    var range_label = event.range.get_label();
    switch( range_label ) {
      case 'H':
        context.color.setHue( parseFloat( event.range.get_value() ) );
        break;
      case 'S':
        context.color.setSaturation( parseFloat( event.range.get_value() ) );
        break;
      case 'L':
        context.color.setLightness( parseFloat( event.range.get_value() ) );
        break;
    }
    var hex = context.color.getHex();
    var rgb = context.color.getRGB();
    context.display.style.backgroundColor = hex;
    context.hex.firstChild.nodeValue = hex;
    context.rgb.set_values( rgb[ 0 ], rgb[ 1 ], rgb[ 2 ] );
  } );
}
ColorWidget.prototype.get_value = function() {
  return this.color.getRGB();
};
ColorWidget.prototype.set_value = function( r, g, b ) {
  this.color.setRGB( r, g, b );
  var hex = this.color.getHex();
  var hsl = this.color.getHSL();
  this.display.style.backgroundColor = hex;
  this.hex.firstChild.nodeValue = hex;
  this.rgb.set_values( r, g, b );
  this.hsl.update( hsl[ 0 ], hsl[ 1 ], hsl[ 2 ] );
};


window.onload = function( event ) {
  var demo = document.getElementById( 'demo' );
  var color = new ColorWidget( 0.0, 0.0, 0.0 );
  demo.appendChild( color.element );
};

</script>
</head>
<body>

<div id="demo"></div>

<pre>TODO:
- build RGB and HSL color selectors (abstract controls)
    - the hue range needs a 6-part gradient
  - need to be able to paste in a hex color from an outside source
  - need conversions to/from decimal triplets
  - need to set up CSS to clean up the ColorWidget
- turn color values into JavaScript literal, and generate CSS rules
- include modified (desolarized) scheme in current use
  - need to design a dark-on-light version of this scheme
- build an interface to show color relations against current color
- set up a scheme designer that picks tones (8) and accents (8)
- write a few small-ish code snippets in C, Python, PHP, Javascript
    (markup stuff to be selectable according to jEdit's and vim's highlighters)
</pre>

</body>
</html>
